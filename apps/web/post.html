<!doctype html>
<!--
  SPDX-License-Identifier: AGPL-3.0-or-later
  Copyright (C) 2025 Joshua Vlantis
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wave Finder Blog Post</title>
  <meta name="description" content="Blog post on Wave Finder." />
  <link rel="canonical" href="https://wavefinder.org/post.html" />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="preload" href="/static/fonts/Outfit-400.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/static/fonts/Outfit-600.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="stylesheet" href="/static/fonts/outfit.css">
  <link rel="icon" href="/static/logo32.png" type="image/png" sizes="32x32">
  <link rel="stylesheet" href="/static/wf-header.css?v=2025-10-05-1">
  <link rel="stylesheet" href="/static/wf-glow.css?v=2025-10-08-1">
  <style>
    :root{ --c-bg:#121212; --c-panel:#1e1e1e; --c-border:#2b3440; --c-accent:#4fc3f7; --c-text:#eaeef5; --c-dim:#aab3c2; --r:12px }
    *{ box-sizing:border-box }
  body{ margin:0; font-family:'OutfitLocal',system-ui,Segoe UI,Roboto,Arial; background:var(--c-bg); color:var(--c-text); position:relative }
  
  /* Decorative glow provided globally via /static/wf-glow.css */
    #top-header{ position:fixed; top:10px; left:50%; transform:translateX(-50%); background:rgba(44,62,80,.95); color:#fff; padding:12px 24px; border-radius:12px; font-size:18px; font-weight:600; letter-spacing:.8px; box-shadow:0 2px 10px rgba(0,0,0,.25); z-index:1001; display:flex; flex-direction:column; gap:2px; align-items:center }
    #nav-pills{ display:flex; gap:10px }
    .pill{ background:rgba(255,255,255,.15); color:#fff; padding:6px 14px; font-size:14px; border-radius:999px; text-decoration:none; font-weight:500; transition:background .2s }
    .pill:hover,.pill.active{ background:rgba(255,255,255,.30) }
    .brand{display:flex;align-items:center;gap:8px}
    .brand-text{font-size:28px;font-weight:700}

    main{ max-width:960px; margin:0 auto; padding:120px 20px 40px; position:relative; z-index:1 }
    @media (min-width: 1400px){
      main{ max-width:1040px }
    }

    .post{ background:linear-gradient(180deg, rgba(34,39,46,.9), rgba(22,26,31,.95)); border:1px solid var(--c-border); border-radius:12px; padding:20px; box-shadow:0 12px 28px rgba(0,0,0,.28) }
    .cover{ width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:10px; margin:0 0 12px; display:none }
    h1.title{ margin:0 0 6px; font-size:26px; text-align:center }
    .meta{ color:var(--c-dim); font-size:12px; margin-bottom:10px; text-align:center }
    .tags{ display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin-bottom:14px }
    .tag{ display:inline-flex; align-items:center; padding:4px 8px; border:1px solid #3a4755; border-radius:999px; font-size:12px; color:#cfe3f6; background:rgba(255,255,255,.04) }
    .content{ color:#d9e2ef; font-size:16px; line-height:1.75 }
    
    /* Headers - all levels supported */
    .content h1{ font-size:28px; margin-top:24px; margin-bottom:8px }
    .content h2{ font-size:22px; margin-top:18px; margin-bottom:6px }
    .content h3{ font-size:18px; margin-top:14px; margin-bottom:4px }
    .content h4{ font-size:16px; margin-top:12px; margin-bottom:4px; font-weight:600 }
    .content h5{ font-size:14px; margin-top:10px; margin-bottom:3px; font-weight:600 }
    .content h6{ font-size:13px; margin-top:8px; margin-bottom:3px; font-weight:600; color:var(--c-dim) }
    
    /* Text elements */
    .content p{ margin:10px 0 }
    .content a{ color:var(--c-accent); text-decoration:underline }
    .content strong{ font-weight:600 }
    .content em{ font-style:italic }
    .content del{ text-decoration:line-through; opacity:0.7 }
    
    /* Lists */
    .content ul, .content ol{ margin:10px 0 10px 20px }
    .content li{ margin:4px 0 }
    .content li > ul, .content li > ol{ margin:4px 0 4px 20px }
    .content ul ul, .content ol ol, .content ul ol, .content ol ul{ margin-top:0; margin-bottom:0 }
    
    /* Task lists */
    .content input[type="checkbox"]{ margin-right:6px }
    .content li.task-list-item{ list-style:none; margin-left:-20px }
    
    /* Code */
    .content code{ background:rgba(255,255,255,0.06); padding:0 4px; border-radius:4px; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace; font-size:.95em }
    .content pre{ background:rgba(255,255,255,0.04); border:1px solid var(--c-border); border-radius:8px; padding:12px; margin:12px 0; overflow-x:auto }
    .content pre code{ background:none; padding:0; border-radius:0; font-size:14px }
    
    /* Tables */
    .content table{ border-collapse:collapse; width:100%; margin:12px 0; border-radius:8px; overflow:hidden; border:1px solid var(--c-border) }
    .content th, .content td{ padding:8px 12px; text-align:left; border-bottom:1px solid var(--c-border) }
    .content th{ background:rgba(255,255,255,0.04); font-weight:600 }
    .content tr:last-child td{ border-bottom:0 }
    .content tr:nth-child(even){ background:rgba(255,255,255,0.02) }
    
    /* Other elements */
    .content blockquote{ border-left:3px solid var(--c-accent); margin:12px 0; padding:8px 12px; color:#c9d6e8; background:rgba(79,195,247,.06); border-radius:6px }
    .content img{ max-width:100%; border-radius:8px; display:block; margin:10px auto }
    .content hr{ border:0; border-top:1px solid var(--c-border); margin:16px 0 }
  
  /* High Contrast handling lives in /static/wf-glow.css */
  </style>
</head>
<body>
  <noscript>
    <div class="wf-js-banner" style="padding:8px 12px;background:#fff3cd;color:#3e3a00;border-bottom:1px solid #f7d070;font:600 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; text-align:center;">⚠️ Wave Finder needs JavaScript enabled for full functionality. Please enable JavaScript and reload.</div>
  </noscript>
  <div id="wf-header"></div>

  <main>
    <article class="post">
      <img id="post-cover" class="cover" alt="" />
      <h1 id="post-title" class="title"></h1>
      <div id="post-meta" class="meta"></div>
      <div id="post-tags" class="tags"></div>
      <div id="post-content" class="content"></div>
    </article>
  </main>

  <!-- Load marked.js for full markdown compliance -->
  <script src="/static/marked.min.js"></script>
  <script>
    // Configure marked for standard markdown compliance
    marked.setOptions({
      gfm: true, // GitHub Flavored Markdown
      breaks: false, // Don't convert \n to <br>
      pedantic: false, // Don't be overly strict
      sanitize: false, // Allow HTML (we trust our content)
      smartypants: false // Don't convert quotes/dashes
    });

    // Custom renderer to add target="_blank" to external links
    const renderer = new marked.Renderer();
    const originalLink = renderer.link;
    renderer.link = function(href, title, text) {
      const isExternal = href && !href.startsWith('/') && !href.startsWith('#') && !href.includes(window.location.hostname);
      const link = originalLink.call(this, href, title, text);
      if (isExternal) {
        return link.replace('<a ', '<a target="_blank" rel="noopener" ');
      }
      return link;
    };

    // Add loading="lazy" to images
    const originalImage = renderer.image;
    renderer.image = function(href, title, text) {
      const img = originalImage.call(this, href, title, text);
      return img.replace('<img ', '<img loading="lazy" ');
    };

    function mdToHtml(md) {
      return marked.parse(md || '', { renderer });
    }

    function estimateReadMins(text){
      const words = (text||'').trim().split(/\s+/).filter(Boolean).length;
      const mins = Math.max(1, Math.round(words / 200));
      return `${mins} min read`;
    }

    async function load(){
      const params = new URLSearchParams(location.search);
      const slug = params.get('slug');
      if (!slug){ location.href = '/blog.html'; return; }
  const posts = await fetch('/data/blog_posts.json').then(r=>r.json());
      const post = posts.find(p=>p.slug===slug);
      if (!post){ document.getElementById('post-title').textContent = 'Post not found'; return; }
      document.title = post.title + ' – Wave Finder Blog';
      const titleEl = document.getElementById('post-title');
      const metaEl = document.getElementById('post-meta');
      const tagsEl = document.getElementById('post-tags');
  const coverEl = document.getElementById('post-cover');

      titleEl.textContent = post.title;

      // Cover image if provided
      if (post.cover && coverEl){
        coverEl.src = post.cover;
        coverEl.style.display = 'block';

        // Optional per-post fit: 'cover' (default) or 'contain' to avoid cropping logos
        const fit = (post.coverFit || 'cover').toLowerCase();
        const pos = (post.coverPosition || 'center').toLowerCase();

        if (fit === 'contain') {
          // Use natural aspect, center, and limit height so logos don't dominate the page
          coverEl.style.objectFit = 'contain';
          // Remove the fixed 16:9 ratio
          coverEl.style.aspectRatio = 'auto';
          // Use natural size within bounds
          coverEl.style.width = 'auto';
          coverEl.style.maxWidth = '100%';
          coverEl.style.height = 'auto';
          coverEl.style.maxHeight = (post.coverMaxHeight ? String(post.coverMaxHeight) : '320') + 'px';
          // Center horizontally
          coverEl.style.margin = '0 auto 12px';
          // A subtle background helps transparent logos
          coverEl.style.background = post.coverBg || 'rgba(255,255,255,0.04)';
          // Optional inner padding for logos with transparent edges
          coverEl.style.padding = (post.coverPadding ? String(post.coverPadding) : '6') + 'px';
        } else {
          // Photo-style cover that fills the 16:9 frame
          coverEl.style.objectFit = 'cover';
          // Keep 16:9 from CSS; allow custom focal point
          coverEl.style.objectPosition = pos;
          // Ensure defaults for spacing/background
          coverEl.style.removeProperty('padding');
          coverEl.style.removeProperty('background');
          coverEl.style.removeProperty('max-height');
          coverEl.style.removeProperty('width');
          coverEl.style.removeProperty('height');
          coverEl.style.removeProperty('max-width');
          coverEl.style.removeProperty('margin');
        }
      }

  const md = await fetch(`/content/posts/${slug}.md`).then(r=>r.text()).catch(()=> '# Missing post');
      const read = estimateReadMins(md);
      metaEl.textContent = `${post.date} • ${post.author} • ${read}`;
      // Tags
      tagsEl.innerHTML = (post.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
      document.getElementById('post-content').innerHTML = mdToHtml(md);
    }
    load();
  </script>
  <script src="/static/wf-header.js?v=2025-10-07-1" defer></script>
  <script>
    (function(){
      function showJsBanner(){
        if (document.querySelector('.wf-js-banner')) return;
        var b = document.createElement('div');
        b.className = 'wf-js-banner';
        b.setAttribute('role','status');
        b.style.cssText = 'padding:8px 12px;background:#fff3cd;color:#3e3a00;border-bottom:1px solid #f7d070;font:600 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; text-align:center;';
        b.textContent = '⚠️ Wave Finder needs JavaScript enabled for full functionality. Please enable JavaScript and reload.';
        document.body.insertBefore(b, document.body.firstChild);
      }
      window.addEventListener('load', function(){ if (!window.__WF_HEADER_LOADED) showJsBanner(); });
    })();
  </script>
</body>
</html>
